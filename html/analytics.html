
<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>newsletter</title>
    <link rel="stylesheet" href="css/libs/clay.css"> 

    <link rel="stylesheet" href="css/libs/main.css">
 <link rel="stylesheet" href="https://unpkg.com/element-ui/lib/theme-chalk/index.css">    
    <link rel="stylesheet" href="css/libs/treeJS.css">
    <link rel="stylesheet" href="css/custom.css">
    <script src="js/libs.js"></script>

 
    <script src="https://unpkg.com/vue/dist/vue.js"></script>
    <script src="https://unpkg.com/element-ui@2.6.1/lib/index.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <script src="https://code.highcharts.com/modules/data.js"></script>
    <script src="https://code.highcharts.com/modules/exporting.js"></script>
    <script src="https://code.highcharts.com/modules/export-data.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/highcharts@6/highcharts.js"></script>
    <!-- vue-highcharts should be load after Highcharts -->
    <script src="https://cdn.jsdelivr.net/npm/vue-highcharts/dist/vue-highcharts.min.js"></script>

    

    

</head>

<body>

    <div class="cims" id="wrapper">
        <header class="header">
            <div class="container-fluid">
                <nav class="main-nav navbar-expand-lg navbar-light">
                    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                        <span class="navbar-toggler-icon"></span>
                    </button>
                    <div class="main-logo">
                        <img class="main-logo__img" src="images/logoCims.png" alt="CIMS logo">
                        <span class="main-logo__name">CIMS</span>
                    </div>
                    <div class="navbar-collapse collapse main-nav__navigation" id="navbarSupportedContent">
                        <div class="main-nav__section main-nav__section--left">
                            
                            <ul class="main-nav__list">
                                <li class="main-nav__item">
                                    <a class="main-nav__link " href="organisation-selection.html">Home</a>
                                </li>
                                <li class="main-nav__item">
                                    <a class="main-nav__link " href="index.html">Messages</a>
                                </li>
                            </ul>

                        </div>

                        <div class="main-nav__section main-nav__section--right">

                            <ul class="main-nav__list">
                                <li class="main-nav__item">
                                    <a class="main-nav__link " href="message-editor.html">New Message</a>
                                </li>
                                <li class="main-nav__item">
                                    <div class="header-dropdown">
                                        <span data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle" data-display="static">
                                            <a data-cq-component="link" href="#" target="_self" class="main-nav__link caret active">Administrator</a>
                                        </span>

                                        <div class="header-dropdown__inner dropdown-menu" role="menu">
                                            <ul class="header-submenu">
                                                    <li class="header-submenu__item">
                                                        <a class="header-submenu__link " href="categories-editor.html">Categories</a>
                                                    </li>
                                                    <li class="header-submenu__item">
                                                        <a class="header-submenu__link " href="ressource-editor.html">Resources</a>
                                                    </li>
                                                    <li class="header-submenu__item">
                                                        <a class="header-submenu__link " href="organisation-settings.html">Organisation Settings</a>
                                                    </li>
                                                    <li class="header-submenu__item">
                                                        <a class="header-submenu__link " href="translation.html">Translation</a>
                                                    </li>
                                                    <li class="header-submenu__item">
                                                        <a class="header-submenu__link " href="rules.html">Rules</a>
                                                    </li>
                                                    <li class="header-submenu__item">
                                                        <a class="header-submenu__link " href="feeds.html">Feeds</a>
                                                    </li>
                                                    <li class="header-submenu__item">
                                                        <a class="header-submenu__link " href="mandatory-categories.html">Mandatory categories</a>
                                                    </li>
                                                    <li class="header-submenu__item">
                                                        <a class="header-submenu__link " href="message-preferences.html">Message preferences</a>
                                                    </li>
                                                    <li class="header-submenu__item">
                                                        <a class="header-submenu__link active" href="newsletter.html">Newsletter</a>
                                                    </li>
                                                    <li class="header-submenu__item">
                                                        <a class="header-submenu__link " href="auditing.html">Auditing</a>
                                                    </li>
                                                    <li class="header-submenu__item">
                                                        <a class="header-submenu__link " href="konzerne.html">Konzerne</a>
                                                    </li>

                                            </ul>
                                        </div>

                                    </div>
                                </li>
                                <li class="main-nav__item">
                                    <a class="main-nav__link" href="#">Sign Out</a>
                                </li>
                            </ul>
                        
                        </div>
                    </div>
                </nav>
            </div>
        </header>
        <main>

            <div class="container-fluid" id="app">
                <div class="analytics">             
                    <el-tabs class="analytics-dashbord" v-model="dashboardsValue" type="card" @tab-remove="removeDashbord">
                        <el-tab-pane closable 
                            v-for="(item, index) in dashboards"
                            :key="item.name"
                            :label="item.title"
                            :name="item.name"
                        >
                        <span class="analytics-dashbord__tab-name" slot="label">
 {{item.title}} 
                            <div class="analytics-dashbord__edit-name" @click="editTabName(item.title, index)">
                                edit
                            </div>
                        </span>
{{item.content}} 
                            <div class="charts">
                                <div class="charts__container">
                                    <div class="chart">
                                        <div class="chart__header">
                                            <ul class="chart-list chart-list--left">
                                                <li class="chart-list__item"  v-bind:class="{ active: isPanelActive }" v-on:click="togglePanel">
                                                    <i class="fas fa-filter"></i>
                                                </li>
                                                <li class="chart-list__item">
                                                    <i class="fas fa-cog"></i>
                                                </li>
                                                <li class="chart-list__item">
                                                    <i class="far fa-chart-bar"></i>
                                                </li>
                                            </ul>
                                            <ul class="chart-list chart-list--right">
                                                <li class="chart-list__item">
                                                    <i class="fas fa-download"></i>
                                                </li>
                                                <li class="chart-list__item">
                                                    <i class="fas fa-trash"></i>
                                                </li>
                                            </ul>
                                        </div>
                                        <div class="chart__body">
                                            

                                            <!-- start panel -->
                                            <div class="chart__panels">
                                                <div class="filters-panel" v-bind:class="{ active: isPanelActive }">
                                                    <div class="filters-panel__btn" v-bind:class="{ active: isPanelActive }" v-if="isPanelActive" v-on:click="togglePanel">
                                                        <span>&nbsp;</span>
                                                        <span class="collapse-icon-closed">
                                                            <i class="fas fa-chevron-left"></i>
                                                        </span>
                                                        <span class="collapse-icon-open">
                                                            
                                                        </span>
                                                        <span class="search-mobile">
                                                            <i class="fas fa-search"></i>
                                                        </span>
                                                    </div>
                                                    <div class="filters-panel__body">
                                                        <form>
                                                            <!-- SEARCH & FILTER STARTS -->
                                    
                                                            <div class="filter-category">
                                                                <div class="filter-category__title">search_and_filter
                                                                </div>
                                                                <div class="filter-category__body">
                                                                    <div class="[ row no-gutters ] filter-category__item">
                                                                        <div class="col-7 offset-4">
                                                                            <div class="select-container">
                                                                                <el-select v-model="selectedUserFilter"
 
                                                                                            >
                                                                                    <el-option
                                                                                            v-for="opt in savedUserFilters"
                                                                                            :label="opt.name"
                                                                                            :key="opt.id"
                                                                                            :value="opt.name">
                                                                                    </el-option>
                                                                                </el-select>
                                                                            </div>
                                                                        </div>
                                                                        <div class="col-1">
                                                                            <div class="open-icon" aria-expanded="true" v-on:click="openFilterListDlg">
                                                                                <i class="fas fa-cog"></i>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                            <!-- SEARCH & FILTER END -->
                                    
                                                            <!-- TEXT & PERIOD FILTER STARTS -->
                                                            <div class="filter-category">
                                                                <a class="filter-category__head collapse-icon" aria-controls="textFilterBody"
                                                                   aria-expanded="true" data-toggle="collapse" href="#textFilterBody" id="textFilter"
                                                                   role="tab">
                                                                    <span class="filter-category__title">text_and_period_filter</span>
                                                                    <span class="collapse-icon-closed">
                                                                                        <i class="fas fa-chevron-down"></i>
                                                                                    </span>
                                                                    <span class="collapse-icon-open">
                                                                                        <i class="fas fa-chevron-up"></i>
                                                                                    </span>
                                                                </a>
                                                                <div class="filter-category__body collapse show" aria-labelledby="textFilter"
                                                                     id="textFilterBody" role="tabpanel">
                                                                    <div class="[ row no-gutters ] filter-category__item">
                                                                        <div class="col-4">
                                                                            <label class="filter-category__label">posted</label>
                                                                        </div>
                                    
                                                                        <div class="col-7">
                                                                            <div class="select-container select-container--icon-right">
                                                                                test
                                                                            </div>
                                                                        </div>
                                    
                                                                    </div>
                                    
                                                                    <div class="[ row no-gutters ] filter-category__item">
                                                                        <div class="col-4">
                                                                            <label class="filter-category__label">text_search</label>
                                                                        </div>
                                    
                                                                        <div class="col-7">
                                                                            <input type="text" class="cims-input filter-category__control"
                                                                                   placeholder="search_title_or_message" v-model="filter.keywords">
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                            <!-- TEXT & PERIOD FILTER END -->
                                    
                                                        
                                                            <div class="btn-container btn-container--center">
                                                                <a href="javascript:void(0)" class="btn-link" value="save" v-on:click="openFilterDlg">
                                                                    <i class="fas fa-save"></i>
                                                                    save_filter
                                                                </a>
                                                            </div>
                                    
                                                            <div class="btn-container btn-container--center">
                                                                <a href="javascript:void(0)" class="btn-link" value="reset"
                                                                   v-on:click="clearFilters($event)">
                                                                    <i class="far fa-trash-alt"></i>
                                                                    reset
                                                                </a>
                                                                <a href="javascript:void(0)" class="btn-link btn-link--primary"
                                                                   v-on:click="doSearch($event)">
                                                                    <i class="fas fa-search"></i>
                                                                    submit
                                                                </a>
                                                            </div>
                                    
                                                        </form>
                                                    </div>
                                                </div>
                                                <!-- ends panel -->
                                            </div>

                                            <div style="flex: 1; overflow: hidden;">
                                                <highcharts class="chart__graph" :options="options" ref="highcharts"></highcharts>
                                            </div>


                                        </div>
                                    </div>
                                </div>
                            </div>
                        </el-tab-pane>
                        <el-tab-pane  v-if="dashboards.length !== 0" :name="`${(tabIndex + 1).toString()}`"> 
                                <span class="add-test" slot="label" @click="addNewDashbord(tabIndex)">
                                    <i class="far fa-plus-square"></i>
                                </span>
                        </el-tab-pane>
                    </el-tabs>

                    <div class="btn-analytics" @click="addNewDashbord(dashboardsValue)"><span class="btn-analytics__title">Add chart</span></div>

                </div>

                <el-dialog title="Category popup" :visible.sync="dlgTabName"
                           custom-class="category-popup">
                    <div class="dialog-body">
                        <el-input
                            class="input-small"
                            v-model="editTitle"
                        ></el-input>
                    </div>
                    <div slot="footer" class="dialog-footer">
                        <el-button size="small" @click="dlgTabName = false">
                            Cancel
                        </el-button>
                        <el-button size="small" type="primary" @click="saveTabName">
                            Confirm
                        </el-button>
                    </div>
                </el-dialog>
            </div>


        </main>

        <footer class="footer">
            <div class="container-fluid">
                <p class="footer__copyright">Â© Copyright 2018 Consline AG</p>
            </div>
        </footer>
        
    </div>


    <!-- SCRIPTS -->
 
    <script type="text/babel">
    var options = {
        title: {
        text: 'Move tooltip only horizontally'
        },
        legend: {
        enabled: false
        },
        credits: {
        enabled: false
        },
        tooltip: {
        positioner: function(labelWidth, labelHeight, point) {
            var seriesPoints = this.chart.series[0].points,
            indexValue, tooltipX, tooltipY;

            seriesPoints.forEach(function(el, inx) {
            if ((point.plotX === Math.round(el.plotX)) && (point.plotY === Math.round(el.plotY))) {
                indexValue = inx;
            }
            });

            tooltipX = point.plotX;
            tooltipY = this.chart.chartHeight - this.chart.plotTop - this.chart.xAxis[0].bottom;

            if (indexValue === 0) {
            tooltipX += this.chart.plotLeft;
            }

            return {
            x: tooltipX,
            y: tooltipY
            };
        },
        shadow: false,
        borderWidth: 1,
        backgroundColor: 'rgba(255,255,255,0.8)'
        },
        xAxis: {
        categories: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec']
        },
        series: [{
        data: [29.9, 71.5, 106.4, 129.2, 144.0, 176.0, 135.6, 148.5, 216.4, 194.1, 95.6, 54.4]
        }]
    }

    Vue.use(VueHighcharts);

    //Vue.use(HighchartsVue);
    new Vue({
        el: "#app",
        data: function() {
            return {
                options: options,
                isPanelActive: true,
                selectedUserFilter: '',
                savedUserFilters: [
                    { name: 'test', id: 1},
                    { name: 'test2', id: 2},
                ],
                filter: {
                    keywords: '',
                },
                dashboardsValue: 0,
                dashboards: [],
                tabIndex: 0,
                dlgTabName: false,
                editTitle: '',
                editTitleIndex: null,

                dashboardsValue: '1',
                dashboards: [
                    {
                        title: 'New Chart 1',
                        name: '1',
                        content: 'New Chart 1'
                    },
                ],
                tabIndex: 1
            }
        },
        methods: {
            addNewDashbord(targetName) {
                console.log(this.tabIndex)
                let newDashbordName = ++this.tabIndex + '';
                const title = `New chart ${this.tabIndex}`
                this.dashboards.push({
                    title: title,
                    name: newDashbordName,
                    content: 'New Tab content',

                });
                
                this.dashboardsValue = newDashbordName;
            },
            removeDashbord(targetName) {
                let tabs = this.dashboards;
                let activeName = this.dashboardsValue;
                console.log(targetName, activeName)
                if (activeName === targetName) {
                    tabs.forEach((tab, index) => {
                        if (tab.name === targetName) {
                            console.log(tab.name)
                            let nextTab = tabs[index + 1] || tabs[index - 1];
                            if (nextTab) {
                                activeName = nextTab.name;
                            }
                        }
                    });
                }
                
                this.dashboardsValue = activeName;
                this.dashboards = tabs.filter(tab => tab.name !== targetName);
            },
            editTabName(name,index) {
                console.log(name)
                this.editTitle = name;
                this.editTitleIndex = index;
                this.dlgTabName = true;
            },
            saveTabName() {
                this.dashboards[this.editTitleIndex].title = this.editTitle;
                console.log(this.editTitleIndex)
                this.dlgTabName = false;
                document.getElementById(`tab-${this.editTitleIndex + 1}`).focus()
            },
            openFilterListDlg() {
                console.log('1')
            },
            openFilterDlg() {
                console.log(1)
            },
            togglePanel(e) {
                console.log(this.isPanelActive)
                this.isPanelActive = !this.isPanelActive
                console.log(this.isPanelActive)
            }
        }
    });
    
        
    </script>
    <script src="js/main.js"></script>
</body>
</html>